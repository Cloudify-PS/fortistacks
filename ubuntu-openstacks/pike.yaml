# vim: set ts=2 et:
  series: xenial
  services:
    ntp:
      charm: "cs:xenial/ntp"
    mysql:
      charm: "cs:xenial/percona-cluster"
      num_units: 1
      options:
        innodb-buffer-pool-size: 1G
        max-connections: 2000
        root-password: D5bWdcGgZSJ0FpXC
        sst-password: nYR5fjEwulLfWDdW
        min-cluster-size: 1
    mongodb:
      charm: cs:xenial/mongodb
      num_units: 1
    ceilometer:
      charm: "cs:xenial/ceilometer"
      num_units: 1
      options:
        openstack-origin: "cloud:xenial-pike"
        region: RegionOne
    ceph-mon:
      charm: "cs:xenial/ceph-mon"
      num_units: 3
      options:
        monitor-count: 3
        fsid: ecbb8960-0e21-11e2-b495-83a88f44db01
        monitor-secret: AQD1P2xQiKglDhAA4NGUF5j38Mhq56qwz+45wg==
        source: "cloud:xenial-updates/pike"
    ceph-osd:
      charm: "cs:xenial/ceph-osd"
      num_units: 3
      options:
        bluestore: true
        osd-devices: /srv/osd
        osd-reformat: 'yes'
        "use-direct-io": false
        source: "cloud:xenial-updates/pike"
    ceph-radosgw:
      charm: "cs:xenial/ceph-radosgw"
      num_units: 1
      options:
        region: RegionOne
        operator-roles: "Member,admin"
        source: "cloud:xenial-updates/pike"
        ceph-osd-replication-count: 3
    cinder:
      charm: "cs:xenial/cinder"
      num_units: 1
      options:
        openstack-origin: "cloud:xenial-pike"
        region: RegionOne
        block-device: None
        glance-api-version: 2
        worker-multiplier: 0.1
        ceph-osd-replication-count: 3
    glance:
      charm: "cs:xenial/glance"
      num_units: 1
      options:
        openstack-origin: "cloud:xenial-pike"
        region: RegionOne
        ceph-osd-replication-count: 3
        worker-multiplier: 0.1
#    opnfv-promise:
 #     charm: cs:xenial/promise
 #     num_units: 1
#    congress:
 #     charm: "cs:xenial/congress"
 #     num_units: 1
  #    options:
   #     region: RegionOne
    keystone:
      charm: "cs:xenial/keystone"
      num_units: 1
      options:
        openstack-origin: "cloud:xenial-pike"
        region: RegionOne
        admin-role: admin
        keystone-admin-role: admin
        preferred-api-version: 2
        worker-multiplier: 0.1
        admin-password: fortinet
        admin-token: admin
    nova-cloud-controller:
      charm: "cs:xenial/nova-cloud-controller"
      num_units: 1
      options:
        openstack-origin: "cloud:xenial-pike"
        region: RegionOne
        console-access-protocol: novnc
        neutron-external-network: ext_net
        #service-guard: true
        worker-multiplier: 0.1
        #console-proxy-ip: None
        network-manager: Neutron
    nova-compute:
      charm: "cs:xenial/nova-compute"
      num_units: 2
      options:
        config-flags: "force_raw_images=True"
        openstack-origin: "cloud:xenial-pike"
        enable-live-migration: true
        enable-resize: true
        migration-auth-type: ssh
        ceph-osd-replication-count: 3
        libvirt-image-backend: rbd
    openstack-dashboard:
      charm: "cs:xenial/openstack-dashboard"
      num_units: 1
      options:
        openstack-origin: "cloud:xenial-pike"
        secret: fortinet
        webroot: /
    rabbitmq-server:
      charm: "cs:xenial/rabbitmq-server"
      num_units: 1
      options:
        ceph-osd-replication-count: 3
    heat:
      charm: "cs:xenial/heat"
      num_units: 1
      options:
        openstack-origin: "cloud:xenial-pike"
        region: RegionOne
        worker-multiplier: 0.1
    neutron-api:
      charm: "cs:xenial/neutron-api"
      num_units: 1
      options:
        openstack-origin: "cloud:xenial-pike"
        region: RegionOne
        "enable-ml2-port-security": true
        neutron-security-groups: true
        worker-multiplier: 0.1
        flat-network-providers: physnet1
        "overlay-network-type": vxlan gre
    neutron-gateway:
      charm: "cs:xenial/neutron-gateway"
      num_units: 1
      options:
        openstack-origin: "cloud:xenial-pike"
        worker-multiplier: 0.1
        bridge-mappings: physnet1:br-ex
        data-port: br-ex:eth1
        instance-mtu: 1400
    aodh:
      charm: "cs:xenial/aodh"
      num_units: 1
      options:
        openstack-origin: "cloud:xenial-pike"
    ceilometer-agent:
      charm: cs:xenial/ceilometer-agent
      options:
        openstack-origin: "cloud:xenial-pike"
    cinder-ceph:
      charm: cs:xenial/cinder-ceph
      options:
        ceph-osd-replication-count: 3
    neutron-openvswitch:
      charm: cs:xenial/neutron-openvswitch
      options:
        bridge-mappings: physnet1:br-ex
  relations:
    - [ 'nova-compute:amqp', 'rabbitmq-server:amqp' ]
    - [ 'neutron-gateway:amqp', 'rabbitmq-server:amqp' ]
    - [ 'keystone:shared-db', 'mysql:shared-db' ]
    - [ 'nova-cloud-controller:identity-service', 'keystone:identity-service' ]
    - [ 'glance:identity-service', 'keystone:identity-service' ]
    - [ 'neutron-api:identity-service', 'keystone:identity-service' ]
    - [ 'neutron-api:shared-db', 'mysql:shared-db' ]
    - [ 'neutron-api:amqp', 'rabbitmq-server:amqp' ]
    - [ 'neutron-gateway:neutron-plugin-api', 'neutron-api:neutron-plugin-api' ]
    - [ 'glance:shared-db', 'mysql:shared-db' ]
    - [ 'glance:amqp', 'rabbitmq-server:amqp' ]
    - [ 'nova-cloud-controller:image-service', 'glance:image-service' ]
    - [ 'nova-compute:image-service', 'glance:image-service' ]
    - [ 'nova-cloud-controller:cloud-compute', 'nova-compute:cloud-compute' ]
    - [ 'nova-cloud-controller:amqp', 'rabbitmq-server:amqp' ]
    - [ 'nova-cloud-controller:quantum-network-service', 'neutron-gateway:quantum-network-service' ]
    - [ 'openstack-dashboard:identity-service', 'keystone:identity-service' ]
    - [ 'nova-cloud-controller:shared-db', 'mysql:shared-db' ]
    - [ 'nova-cloud-controller:neutron-api', 'neutron-api:neutron-api' ]
    - [ 'cinder:image-service', 'glance:image-service' ]
    - [ 'cinder:amqp', 'rabbitmq-server:amqp' ]
    - [ 'cinder:identity-service', 'keystone:identity-service' ]
    - [ 'cinder:cinder-volume-service', 'nova-cloud-controller:cinder-volume-service' ]
    - [ 'cinder:shared-db', 'mysql:shared-db' ]
    - [ 'cinder-ceph:storage-backend', 'cinder:storage-backend' ]
    - [ 'ceph-mon:client', 'nova-compute:ceph' ]
    - [ 'ceph-mon:client', 'cinder-ceph:ceph' ]
    - [ 'ceph-mon:client', 'glance:ceph' ]
    - [ 'ceph-osd:mon', 'ceph-mon:osd' ]
    - [ 'ceph-radosgw:mon', 'ceph-mon:radosgw' ]
    - [ 'ceph-radosgw:identity-service', 'keystone:identity-service' ]
#    - [ 'congress:shared-db', 'mysql:shared-db' ]
#    - [ 'congress:identity-service', 'keystone:identity-service' ]
#    - [ 'congress:amqp', 'rabbitmq-server:amqp' ]
    - [ 'ceilometer:amqp', 'rabbitmq-server:amqp' ]
    - [ 'ceilometer-agent:ceilometer-service', 'ceilometer:ceilometer-service' ]
    - [ 'ceilometer:identity-service', 'keystone:identity-service' ]
    - [ 'ceilometer:identity-notifications', 'keystone:identity-notifications' ]
    - [ 'ceilometer-agent:nova-ceilometer', 'nova-compute:nova-ceilometer' ]
    - [ 'ceilometer:shared-db', 'mongodb:database' ]
    - [ 'heat:shared-db', 'mysql:shared-db' ]
    - [ 'heat:identity-service', 'keystone:identity-service' ]
    - [ 'heat:amqp', 'rabbitmq-server:amqp' ]
    - [ 'aodh:amqp', 'rabbitmq-server:amqp' ]
    - [ 'aodh:shared-db', 'mysql:shared-db' ]
    - [ 'aodh:identity-service', 'keystone:identity-service' ]
    - [ 'neutron-openvswitch:amqp', 'rabbitmq-server:amqp' ]
    - [ 'nova-compute:neutron-plugin', 'neutron-openvswitch:neutron-plugin' ]
    - [ 'neutron-openvswitch:neutron-plugin-api', 'neutron-api:neutron-plugin-api' ]

