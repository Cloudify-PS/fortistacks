tosca_definitions_version: cloudify_dsl_1_3

imports:
  - http://www.getcloudify.org/spec/cloudify/4.2/types.yaml
  - http://www.getcloudify.org/spec/openstack-plugin/2.0.1/plugin.yaml
  - http://www.getcloudify.org/spec/diamond-plugin/1.3.6/plugin.yaml
  - types/fortigate-types.yaml
  - types/openstack-fortigate-types.yaml


inputs:
  image: {}
  flavor: {}

node_templates:

  fortigate_security_group:
    type: fortigateSecurityGroup

  fortigate_monitored:
    type: cloudify.openstack.nodes.Server
    properties:
      image: { get_input: image }
      flavor: { get_input: flavor }
    relationships:
     - type: cloudify.openstack.server_connected_to_security_group
       target: fortigate_security_group

  fortigated_configuring_node:
    type: fortigatedConfiguringNode
    relationships:
      - type: cloudify.relationships.contained_in
        target: fortigate_monitored

  fortigate_proxy_node:
    type: fortigateManagerProxy
    relationships:
     - type: cloudify.relationships.depends_on
       target: fortigated_configuring_node # Assure that Diamond starts after fortigated is configured
     - type: cloudify.relationships.monitors
       target: fortigate_monitored_host
         cloudify.interfaces.relationship_lifecycle:
           preconfigure:
             inputs:
               user: 'admin'
               passwordd: ''
               vdom: ''